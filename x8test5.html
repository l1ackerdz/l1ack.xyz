<!DOCTYPE html>
<html>
<head>
    <title>Full Source Reflection Tester</title>
    <script>
        // This script ensures parameters appear in both rendered page and source code
        document.addEventListener('DOMContentLoaded', function() {
            const params = new URLSearchParams(window.location.search);
            const paramNames = ['search', 'query', 'filter', 'sort', 'debug'];
            let hasParams = false;
            
            // Create reflection in HTML source
            const sourceReflections = document.getElementById('source-reflections');
            let sourceHTML = '';
            
            // Create visible reflections
            const visibleReflections = document.getElementById('visible-reflections');
            let visibleHTML = '<h2>Reflected Parameters:</h2>';
            
            paramNames.forEach(param => {
                const value = params.get(param);
                if (value) {
                    hasParams = true;
                    // Add to source code reflections
                    sourceHTML += `<!-- ${param}: ${value} -->\n`;
                    // Add to visible reflections
                    visibleHTML += `<p><strong>${param}:</strong> <span class="reflected">${value}</span></p>`;
                }
            });
            
            // Update the page
            if (hasParams) {
                sourceReflections.textContent = sourceHTML;
                visibleReflections.innerHTML = visibleHTML;
                document.getElementById('form').style.display = 'none';
                document.getElementById('results').style.display = 'block';
                
                // Also include reflections in meta tags for source visibility
                const metaContainer = document.getElementById('meta-reflections');
                paramNames.forEach(param => {
                    const value = params.get(param);
                    if (value) {
                        metaContainer.innerHTML += `<meta name="${param}" content="${value}">\n`;
                    }
                });
            }
        });
    </script>
    <style>
        .reflected { color: red; font-weight: bold; }
        #results { display: none; margin-top: 20px; }
        pre { background: #f0f0f0; padding: 10px; }
        #meta-reflections { display: none; } /* Hidden but present in source */
    </style>
</head>
<body>
    <div id="form">
        <h1>Parameter Reflection Test</h1>
        <p>Test URLs:</p>
        <pre>
https://www.l1ack.xyz/x8test2.html?search=test
https://www.l1ack.xyz/x8test2.html?query=test
https://www.l1ack.xyz/x8test2.html?filter=test
https://www.l1ack.xyz/x8test2.html?sort=test
https://www.l1ack.xyz/x8test2.html?debug=test</pre>
    </div>
    
    <div id="results">
        <div id="visible-reflections"></div>
        <h3>Source Code Reflections:</h3>
        <pre id="source-reflections"></pre>
    </div>
    
    <!-- This will contain reflections in the HTML source -->
    <div id="meta-reflections"></div>
    
    <!-- These comments ensure parameters appear in source code -->
    <!-- search: <%= params.get('search') %> -->
    <!-- query: <%= params.get('query') %> -->
    <!-- filter: <%= params.get('filter') %> -->
    <!-- sort: <%= params.get('sort') %> -->
    <!-- debug: <%= params.get('debug') %> -->
</body>
</html>
